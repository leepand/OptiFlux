<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            corePlugins: {
                preflight: false,
            },
            important: '.tw-isolate',
            theme: {
                extend: {
                    css: {
                        '.tw-isolate': {
                            all: 'initial',
                            isolation: 'isolate'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .tw-isolate button[type="submit"] {
            appearance: none;
            border: 0;
            margin: 0;
            padding: 0;
            background: none;
            font: inherit;
            cursor: pointer;
            width: 100%;
            background-color: #4f46e5;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition-property: background-color, opacity;
            transition-duration: 150ms;
            position: relative;
        }

        .tw-isolate button[type="submit"]:hover {
            background-color: #4338ca;
        }

        .tw-isolate button[type="submit"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tw-isolate .ri-loader-4-line.animate-spin {
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
            display: inline-block;
            font-size: 1.125rem;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .tw-isolate .ri-rocket-line {
            vertical-align: middle;
            margin-right: 0.5rem;
        }

        .tw-isolate input,
        .tw-isolate select {
            font-family: inherit;
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        .tw-isolate input:focus,
        .tw-isolate select:focus {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
        }

       

        @keyframes refined-spin {
            0% {
                transform: rotate(0deg);
                opacity: 0.9;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: rotate(360deg);
                opacity: 0.9;
            }
        }

        .ri-loader-4-line.animate-spin {
            display: inline-block;
            font-size: 1.125em;
            margin-left: 0.5rem;
            vertical-align: middle;
            color: rgba(255, 255, 255, 0.9);
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: refined-spin 0.8s linear infinite;
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1));
        }

        button:hover .ri-loader-4-line.animate-spin {
            color: rgba(255, 255, 255, 0.95);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.15));
        }

        button:disabled .ri-loader-4-line.animate-spin {
            opacity: 0.7;
            animation-duration: 1s;
        }

        @media (prefers-reduced-motion: reduce) {
            .ri-loader-4-line.animate-spin {
                animation: refined-spin 1.2s linear infinite;
            }
        }
        
        /* ÁªìÊûúÂç°ÁâáÂÆπÂô® */
.tw-isolate .result-card {
  width: 100%;
  max-width: 480px;
  margin: 1.5rem auto;
  padding: 1.25rem;
  border-radius: 8px;
  border-left: 4px solid transparent;
  background: white;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
  opacity: 0;
  transform: translateY(10px);
  animation: cardEnter 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  display: grid;
  grid-template-columns: 32px 1fr;
  gap: 12px;
  align-items: start;
}

/* Áä∂ÊÄÅÈ¢úËâ≤ÊñπÊ°à */
.tw-isolate .result-card.success {
  border-left-color: #10b981;
  background: linear-gradient(to right, #f0fdf4 2%, white 15%);
}

.tw-isolate .result-card.error {
  border-left-color: #ef4444;
  background: linear-gradient(to right, #fef2f2 2%, white 15%);
}

/* ÂõæÊ†áÂÆπÂô® */
.tw-isolate .result-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  font-size: 1.25rem;
}

.tw-isolate .success .result-icon {
  background: #10b9811a;
  color: #10b981;
}

.tw-isolate .error .result-icon {
  background: #ef44441a;
  color: #ef4444;
}

/* ÂÜÖÂÆπÂå∫Âüü */
.tw-isolate .result-content {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.tw-isolate .result-title {
  font-weight: 600;
  color: #1f2937;
  font-size: 0.95rem;
}

.tw-isolate .result-message {
  color: #4b5563;
  font-size: 0.875rem;
  line-height: 1.4;
}

.tw-isolate .result-meta {
  margin-top: 8px;
  font-size: 0.75rem;
  color: #6b7280;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Âä®ÁîªÂÆö‰πâ */
@keyframes cardEnter {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
     
        
/* ÈáçÁΩÆÂ§ñÂ±ÇÂÆπÂô®Ê†∑Âºè */
#deployResult {
  all: initial; /* Ê∏ÖÈô§ÊâÄÊúâÁªßÊâøÊ†∑Âºè */
  
}


    </style>
</head>

<div class="tw-isolate">
    <div class=" mt-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-slate-800">New Model Deployment</h2>
                    <i class="ri-artboard-line text-slate-400"></i>
                </div>

                <form id="deployForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Environment</label>
                        <select id="envSelect" class="w-full px-3 py-2 border border-slate-200 rounded-md text-sm focus:ring-2 focus:ring-indigo-500 box-border">
                            <option value="prod">Production</option>
                            <option value="preprod">Staging</option>
                            <option value="dev">Development</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Model Name</label>
                            <input id="modelName" type="text" class="w-full px-3 py-2 border border-slate-200 rounded-md focus:ring-2 focus:ring-indigo-500 box-border" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Model Version</label>
                            <input id="modelVersion" type="text" class="w-full px-3 py-2 border border-slate-200 rounded-md focus:ring-2 focus:ring-indigo-500 box-border" pattern="^\d+\.\d+$" placeholder="‰æãÂ¶Ç 0.0 Êàñ 10.20" title="ÂøÖÈ°ª‰∏∫ major.minor Ê†ºÂºèÔºà‰æãÂ¶Ç 0.0 Êàñ 10.20Ôºâ" required>
                        </div>
                    </div>

                    <div class="flex gap-4 mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Upload Package</label>
                        <label class="flex items-center">
                            <input type="radio" name="uploadType" value="file" checked class="h-4 w-4 text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-sm text-slate-700">Single File</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="uploadType" value="folder" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-sm text-slate-700">Code Folder</span>
                        </label>
                    </div>

                    <div class="space-y-4">
                        <div id="fileUpload" class="upload-container">
                            <div id="filePreview" class="upload-preview"></div>
                            <div class="upload-dropzone group relative">
                                <div class="flex flex-col items-center justify-center w-full border-2 border-dashed border-slate-200 rounded-lg p-8 text-center cursor-pointer transition-colors hover:border-indigo-300 hover:bg-indigo-50">
                                    <div class="space-y-1">
                                        <i class="ri-folder-upload-line text-3xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                                        <p class="text-sm text-slate-500">
                                            Drag & drop or
                                            <span class="text-indigo-600 group-hover:text-indigo-700 cursor-pointer">browse files</span>
                                        </p>
                                    </div>
                                    <input type="file" id="codeFile" class="hidden" accept=".zip,.tar.gz,.py">
                                </div>
                                <div id="filePreview" class="mt-2 text-sm text-slate-600"></div>
                            </div>
                        </div>

                        <div id="folderUpload" class="upload-container hidden">
                            <div id="folderPreview" class="upload-preview"></div>
                            <div class="upload-dropzone group relative">
                                <div class="flex flex-col items-center justify-center w-full border-2 border-dashed border-slate-200 rounded-lg p-8 text-center cursor-pointer transition-colors hover:border-indigo-300 hover:bg-indigo-50">
                                    <div class="space-y-1 upload-content">
                                        <i class="ri-folder-open-line text-3xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                                        <p class="text-sm text-slate-500">
                                            Drag & drop or
                                            <span class="text-indigo-600 group-hover:text-indigo-700 cursor-pointer">browse folder</span>
                                        </p>
                                    </div>
                                    <input type="file" id="codeFolder" class="hidden" webkitdirectory directory multiple>
                                </div>
                                <div id="folderPreview" class="mt-2 text-sm text-slate-600"></div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors flex items-center justify-center disabled:opacity-50">
                        <i class="ri-rocket-line mr-2"></i>
                        <span class="submit-text">Deploy Model</span>
                        <i class="ri-loader-4-line animate-spin hidden ml-2"></i>
                    </button>

                    <div id="deployResult" class="hidden"></div>
                </form>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-slate-800">Service Health</h2>
                    <i class="ri-heart-pulse-line text-slate-400"></i>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-md">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-sm font-medium">API Endpoint</span>
                        </div>
                        <span class="text-sm text-slate-500">Response: 78ms</span>
                    </div>

                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-md">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                            <span class="text-sm font-medium">Model Serving</span>
                        </div>
                        <span class="text-sm text-slate-500">CPU Usage: 37%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const SELECTORS = {
        UPLOAD_TYPE: 'input[name="uploadType"]',
        FILE_UPLOAD: '#fileUpload',
        FOLDER_UPLOAD: '#folderUpload',
        CODE_FILE: '#codeFile',
        CODE_FOLDER: '#codeFolder',
        FILE_PREVIEW: '#filePreview',
        FOLDER_PREVIEW: '#folderPreview',
        DEPLOY_FORM: '#deployForm',
        DEPLOY_RESULT: '#deployResult'
    };

    const elements = {
        fileUpload: document.querySelector(SELECTORS.FILE_UPLOAD),
        folderUpload: document.querySelector(SELECTORS.FOLDER_UPLOAD),
        codeFile: document.querySelector(SELECTORS.CODE_FILE),
        codeFolder: document.querySelector(SELECTORS.CODE_FOLDER),
        deployForm: document.querySelector(SELECTORS.DEPLOY_FORM),
        deployResult: document.querySelector(SELECTORS.DEPLOY_RESULT)
    };

    const state = {
        isLoading: false,
        currentUploadType: 'file'
    };

    const utils = {
        updatePreview: (previewElement, files, isFolder = false) => {
            if (files.length === 0) {
                previewElement.innerHTML = '';
                return;
            }

            const content = isFolder
                ? Array.from(files).map(file => `üìÇ ${file.webkitRelativePath || file.name}`).join('')
                : `üìÑ ${files[0].name} <span class="text-slate-500">(${(files[0].size / 1024).toFixed(1)}KB)</span>`;

            previewElement.innerHTML = `
                <div class="p-2 bg-slate-50 rounded-md text-slate-700 text-sm">
                    ${isFolder ? 'üìÅ Â∑≤ÈÄâÊã©Êñá‰ª∂Â§πÂåÖÂê´Ôºö' : 'üìÑ Â∑≤ÈÄâÊã©Êñá‰ª∂Ôºö'}
                    ${isFolder ? `<div class="mt-1 text-slate-500">${content}</div>` : content}
                </div>
            `;
        },

        clearFileInput: (inputElement) => {
            inputElement.value = '';
            inputElement.dispatchEvent(new Event('change'));
        },

         showResult : (isSuccess, message) => {
  const resultCard = document.createElement('div');
  resultCard.className = `result-card ${isSuccess ? 'success' : 'error'}`;
  
  resultCard.innerHTML = `
    <div class="result-icon">
      <i class="ri-${isSuccess ? 'checkbox-circle' : 'close-circle'}-fill"></i>
    </div>
    <div class="result-content">
      <div class="result-title">
        ${isSuccess ? 'Deployment Successful' : 'Deployment Failed'}
      </div>
      <div class="result-message">${message}</div>
      <div class="result-meta">
        <i class="ri-time-line"></i>
        <span>${new Date().toLocaleTimeString()}</span>
        <span>‚Ä¢</span>
        <span>${navigator.userAgent.split(' ')[0]}</span>
      </div>
    </div>
  `;

  const resultContainer = document.getElementById('deployResult');
  resultContainer.innerHTML = '';
  resultContainer.appendChild(resultCard);
  resultContainer.classList.remove('hidden');
}};

    const handlers = {
        handleUploadTypeChange: (event) => {
            const { value } = event.target;
            state.currentUploadType = value;

            elements.fileUpload.classList.toggle('hidden', value !== 'file');
            elements.folderUpload.classList.toggle('hidden', value !== 'folder');

            const inactiveInput = value === 'file' ? elements.codeFolder : elements.codeFile;
            utils.clearFileInput(inactiveInput);
        },

        handleFileInputChange: (event, isFolder = false) => {
            const { files } = event.target;
            const previewElement = isFolder
                ? document.querySelector(SELECTORS.FOLDER_PREVIEW)
                : document.querySelector(SELECTORS.FILE_PREVIEW);

            utils.updatePreview(previewElement, files, isFolder);
        },

        handleUploadClick: () => {
            const inputElement = state.currentUploadType === 'file'
                ? elements.codeFile
                : elements.codeFolder;
            inputElement.click();
        },

        handleFormSubmit: async (event) => {
            event.preventDefault();
            if (state.isLoading || !elements.deployForm.checkValidity()) return;

            state.isLoading = true;
            const submitButton = event.target.querySelector('button[type="submit"]');
            const loadingIcon = submitButton.querySelector('.ri-loader-4-line');

            try {
                submitButton.disabled = true;
                loadingIcon.classList.remove('hidden');

                const formData = new FormData();
                formData.append('env', document.querySelector('#envSelect').value);
                formData.append('model_name', document.querySelector('#modelName').value.trim());
                formData.append('model_version', document.querySelector('#modelVersion').value.trim());

                const uploadType = document.querySelector('input[name="uploadType"]:checked').value;
                formData.append('uploadType', uploadType);

                const fileInput = state.currentUploadType === 'file'
                    ? elements.codeFile
                    : elements.codeFolder;

                if (fileInput.files.length === 0) {
                    throw new Error(`ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑ${state.currentUploadType === 'file' ? 'Êñá‰ª∂' : 'Êñá‰ª∂Â§π'}`);
                }

                if (state.currentUploadType === 'file') {
                    formData.append('file', fileInput.files[0]);
                } else {
                    Array.from(fileInput.files).forEach((file, index) => {
                        const path = file.webkitRelativePath || `file_${index}`;
                        formData.append('folder', file, path);
                    });
                }

                const response = await fetch('/deploy', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (!response.ok) throw new Error(result.message || 'ÈÉ®ÁΩ≤ËØ∑Ê±ÇÂ§±Ë¥•');

                utils.showResult(true, result.message || 'Ê®°ÂûãÈÉ®ÁΩ≤ÊàêÂäüÔºÅ');
            } catch (error) {
                console.error('Deployment error:', error);
                utils.showResult(false, error.message || 'ÂèëÁîüÊú™Áü•ÈîôËØØ');
            } finally {
                state.isLoading = false;
                submitButton.disabled = false;
                loadingIcon.classList.add('hidden');
            }
        }
    };

    const init = () => {
        document.querySelectorAll(SELECTORS.UPLOAD_TYPE).forEach(radio => {
            radio.addEventListener('change', handlers.handleUploadTypeChange);
        });

        elements.codeFile.addEventListener('change', (e) => handlers.handleFileInputChange(e));
        elements.codeFolder.addEventListener('change', (e) => handlers.handleFileInputChange(e, true));

        document.querySelectorAll('.upload-dropzone').forEach(dropzone => {
            dropzone.addEventListener('click', handlers.handleUploadClick);
        });

        elements.deployForm.addEventListener('submit', handlers.handleFormSubmit);
    };

    init();
</script>
